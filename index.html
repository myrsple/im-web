<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NWRK6NW8');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Island Mint</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Mesmerizing, sun-drenched, heartwarming... Island Mint is a five-piece indie band based in Prague, Czechia. Stream SLUN and get tickets for our upcoming shows.">
    <meta name="author" content="Island Mint">
    <meta name="robots" content="index, follow, max-image-preview:large">
    <link rel="canonical" href="https://islandmint.cz/">
    
    <!-- Favicon (square for platforms that use site icon) -->
    <link rel="icon" type="image/png" href="images/og-square.png">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Island Mint">
    <meta property="og:description" content="Mesmerizing, sun-drenched, heartwarming... Island Mint is a five-piece indie band based in Prague, Czech Republic.">
    <meta property="og:locale" content="en_US">
    <!-- Prefer landscape for platforms that show wide previews -->
    <meta property="og:image" content="https://islandmint.cz/images/og.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Island Mint band photo with logo">
    <meta property="og:image:secure_url" content="https://islandmint.cz/images/og.jpg">
    <!-- Provide a square alternative for crawlers (e.g., Google/Slack small cards) -->
    <meta property="og:image" content="https://islandmint.cz/images/og-square.png">
    <meta property="og:image:width" content="1600">
    <meta property="og:image:height" content="1600">
    <meta property="og:image:alt" content="Island Mint square logo">
    <meta property="og:image:secure_url" content="https://islandmint.cz/images/og-square.png">
    <meta property="og:url" content="https://islandmint.cz/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Island Mint">
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Island Mint">
    <meta name="twitter:description" content="Mesmerizing, sun-drenched, heartwarming... Island Mint is a five-piece indie band based in Prague, Czech Republic.">
    <meta name="twitter:image" content="https://islandmint.cz/images/og.jpg">
    <meta name="twitter:image:alt" content="Island Mint band photo with logo">
    <!-- Some parsers also look at itemprop as fallback -->
    <meta itemprop="image" content="https://islandmint.cz/images/og.jpg">
    
    <!-- Organization / MusicGroup structured data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "MusicGroup",
      "name": "Island Mint",
      "url": "https://islandmint.cz/",
      "logo": "https://islandmint.cz/images/og-square.png",
      "sameAs": [
        "https://open.spotify.com/artist/1vVcWrAI5GcT8A2c9KZS2j",
        "https://www.youtube.com/channel/UCFD8e2-RvRZUxgyjmrukrSQ",
        "https://www.instagram.com/island_mint/",
        "https://islandmint.bandcamp.com/",
        "https://music.apple.com/cz/artist/island-mint/1514755142"
      ]
    }
    </script>
    
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- DNS prefetch for external domains -->
    <link rel="dns-prefetch" href="//i.ytimg.com">
    <link rel="dns-prefetch" href="//api.allorigins.win">
    <link rel="dns-prefetch" href="//docs.google.com">
    
    <!-- Preload critical images -->
    <link rel="preload" as="image" href="images/island-mint.png">
    <link rel="preload" as="image" href="images/mint.JPG">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script defer src="https://cloud.umami.is/script.js" data-website-id="c1b71881-5c8e-4f36-87ff-05f338b2c258"></script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NWRK6NW8" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <!-- Full-screen Snake Game Overlay -->
    <div id="snake-game"></div>
    <!-- Clickable area for game controls -->
    <div class="game-controls"></div>

    <!-- Slun album popup modal -->
    <div id="slun-modal" class="slun-modal-overlay" aria-hidden="true">
        <div class="slun-modal-content" role="dialog" aria-modal="true" aria-label="Slun album">
            <button class="slun-modal-close" aria-label="Close popup">×</button>
            <a href="https://open.spotify.com/album/0Z7BWVEHBT8qQdcuNCSW4S" target="_blank" rel="noopener noreferrer" class="slun-modal-link">
                <img src="images/slun.png" alt="Slun album by Island Mint" class="slun-modal-image">
            </a>
        </div>
    </div>

    <header>
        <img src="images/island-mint.png" alt="Island Mint" class="logo" width="1600" height="482">
        <div class="social-links">
            <a href="https://open.spotify.com/artist/1vVcWrAI5GcT8A2c9KZS2j" target="_blank" rel="noopener noreferrer" aria-label="Spotify">
                <i class="fab fa-spotify"></i>
            </a>
            <a href="https://www.youtube.com/channel/UCFD8e2-RvRZUxgyjmrukrSQ" target="_blank" rel="noopener noreferrer" aria-label="YouTube">
                <i class="fab fa-youtube"></i>
            </a>
            <a href="https://www.instagram.com/island_mint/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
            </a>
            <a href="https://islandmint.bandcamp.com/" target="_blank" rel="noopener noreferrer" aria-label="Bandcamp">
                <i class="fab fa-bandcamp"></i>
            </a>
            <a href="https://music.apple.com/cz/artist/island-mint/1514755142" target="_blank" rel="noopener noreferrer" aria-label="Apple Music">
                <i class="fab fa-itunes-note"></i>
            </a>
        </div>
    </header>
    
    <section class="hero-image">
        <img src="images/mint.JPG" alt="Island Mint" fetchpriority="high" width="1800" height="1200">
    </section>
    
    
    
    <section class="video-section">
        <div class="video-container">
            <iframe 
                src="https://www.youtube.com/embed/cd6Uz6H8lX8?si=Y5GCE0ymEWa-5Cc-" 
                title="Island Mint Video"
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                loading="lazy" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
            </iframe>
        </div>
    </section>
    
    <section class="linktree-section">
        <h1 class="main-title">Island Mint</h1>
        <div class="bio-text">
            <p>"Mesmerizing, sun-drenched and heartwarming, the music of Island Mint is a rare occurrence on the Prague music scene. Inspired by 60s sunshine pop, garage rock, and 90s shoegaze, the band's warm analog sound submerges you in an ocean of childlike nostalgia."</p>
        </div>
        
        <div class="linktree-container">
            <div class="linktree-column">
                <h2 class="column-headline">SLUN</h2>
                <div class="column-cards">
            <a href="https://goout.net/en/island-mint-album-release%2Bbrankos-bridge/szyjuvx/" target="_blank" rel="noopener noreferrer" class="linktree-card album-release-card" data-fetch-og="true">
                        <div class="card-image">
                            <img src="images/mint.JPG" alt="Concert" class="og-image" loading="lazy" decoding="async" width="80" height="80">
                        </div>
                        <div class="card-content">
                            <h3>Album release party Oct 31</h3>
                        </div>
                    </a>
                    
                    <a href="https://open.spotify.com/album/0Z7BWVEHBT8qQdcuNCSW4S" target="_blank" rel="noopener noreferrer" class="linktree-card" data-fetch-og="true">
                        <div class="card-image">
                            <img src="images/mint.JPG" alt="Stream on Spotify" class="og-image" loading="lazy" decoding="async" width="80" height="80">
                        </div>
                        <div class="card-content">
                            <h3>Stream on Spotify</h3>
                        </div>
                    </a>
                    
                    <a href="https://www.youtube.com/watch?v=mr4c68tMHqo" target="_blank" rel="noopener noreferrer" class="linktree-card" data-fetch-og="true">
                        <div class="card-image">
                            <img src="https://i.ytimg.com/vi/mr4c68tMHqo/maxresdefault.jpg" alt="YouTube video" class="og-image" loading="lazy" decoding="async" width="1280" height="720">
                        </div>
                        <div class="card-content">
                            <h3>Fool Around – music video</h3>
                        </div>
                    </a>
                </div>
            </div>
            
            <div class="linktree-column">
                <h2 class="column-headline">Music videos</h2>
                <div class="column-cards">
                    <a href="https://youtu.be/cbvx9q_GjBc?si=J-HrtaYUzlghjpOu" target="_blank" rel="noopener noreferrer" class="linktree-card" data-fetch-og="true">
                        <div class="card-image">
                            <img src="https://i.ytimg.com/vi/cbvx9q_GjBc/maxresdefault.jpg" alt="Man of the People" class="og-image" loading="lazy" decoding="async" width="1280" height="720">
                        </div>
                        <div class="card-content">
                            <h3>Man of the People</h3>
                        </div>
                    </a>
                    
                    <a href="https://www.youtube.com/watch?v=FMpJhj0Qwp0" target="_blank" rel="noopener noreferrer" class="linktree-card" data-fetch-og="true">
                        <div class="card-image">
                            <img src="https://i.ytimg.com/vi/FMpJhj0Qwp0/maxresdefault.jpg" alt="Burnout" class="og-image" loading="lazy" decoding="async" width="1280" height="720">
                        </div>
                        <div class="card-content">
                            <h3>Burnout</h3>
                        </div>
                    </a>
                    
                    <a href="https://www.youtube.com/watch?v=kLiK7QKFzxs" target="_blank" rel="noopener noreferrer" class="linktree-card" data-fetch-og="true">
                        <div class="card-image">
                            <img src="https://i.ytimg.com/vi/kLiK7QKFzxs/maxresdefault.jpg" alt="Insomnia Town" class="og-image" loading="lazy" decoding="async" width="1280" height="720">
                        </div>
                        <div class="card-content">
                            <h3>Insomnia Town</h3>
                        </div>
                    </a>
                    
                    <a href="https://www.youtube.com/watch?v=sOo313Juwvs" target="_blank" rel="noopener noreferrer" class="linktree-card" data-fetch-og="true">
                        <div class="card-image">
                            <img src="https://i.ytimg.com/vi/sOo313Juwvs/maxresdefault.jpg" alt="Irreality" class="og-image" loading="lazy" decoding="async" width="1280" height="720">
                        </div>
                        <div class="card-content">
                            <h3>Irreality</h3>
                        </div>
                    </a>
                </div>
            </div>
            
            <div class="linktree-column">
                <h2 class="column-headline">Interviews</h2>
                <div class="column-cards">
                    <a href="https://swarmmag.com/music/all-studium-no-punctum/" target="_blank" rel="noopener noreferrer" class="linktree-card" data-fetch-og="true">
                        <div class="card-image">
                            <img src="images/mint.JPG" alt="Interview" class="og-image" loading="lazy" decoding="async" width="80" height="80">
                        </div>
                        <div class="card-content">
                            <h3>Swarm Mag</h3>
                        </div>
                    </a>
                    
                    <a href="https://wave.rozhlas.cz/hudba-je-pro-me-hra-odhaluju-v-ni-sve-vnitrni-dite-rika-matyas-adamek-z-kapely-8763898" target="_blank" rel="noopener noreferrer" class="linktree-card" data-fetch-og="true">
                        <div class="card-image">
                            <img src="images/mint.JPG" alt="Radio Interview" class="og-image" loading="lazy" decoding="async" width="80" height="80">
                        </div>
                        <div class="card-content">
                            <h3>Radio Wave</h3>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </section>
    
    <section class="shows-section">
        <div class="shows-container" data-sheet-id="1Mq2fPlflhmgZwLdS-JCFTSFWVKy55PTcO4pMCk9LxMs" data-sheet-name="Upcoming" data-sheet-gid="0">
            <h2 class="shows-title">Upcoming shows</h2>
            <div class="shows-table-wrapper">
                <table class="shows-table" aria-describedby="shows-note">
                    <colgroup>
                        <col style="width:18%">
                        <col style="width:26%">
                        <col style="width:34%">
                        <col style="width:11%">
                        <col style="width:11%">
                    </colgroup>
                    <tbody id="shows-tbody">
                        <tr>
                            <td colspan="5" class="shows-empty">Loading…</td>
                        </tr>
                    </tbody>
                </table>
                <p id="shows-note" class="visually-hidden">This table can be automatically populated from Google Sheets.</p>
            </div>
        </div>
    </section>
    
    <section class="contact-section">
        <div class="contact-container">
            <div class="contact-column">
                <h2 class="contact-headline">
                    <a href="https://drive.google.com/drive/folders/1L6kzdaAbbi2RM4kCTNmkJfphqVOyU--B?usp=sharing" target="_blank" rel="noopener noreferrer">Media kit & rider</a>
                </h2>
            </div>
            <div class="contact-column">
                <h2 class="contact-headline">
                    <a href="mailto:booking@paperwallrecords.com">Book us</a>
                </h2>
            </div>
        </div>
    </section>
    
    <section class="video-section">
        <div class="video-container">
            <iframe 
                src="https://www.youtube.com/embed/b6qPl9TfgVs?si=lUJkGzKDAGHFbwdJ" 
                title="Radio Wave Studio Session"
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                loading="lazy" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
            </iframe>
        </div>
    </section>
    
    <section class="osa-banner">
        <img src="images/osa-logo.png" alt="OSA logo" class="osa-logo" width="140" height="61" loading="lazy" decoding="async">
    </section>
    
    <footer>
        <p class="copyright">© 2025 Island Mint | site by <a href="https://kovarik.xyz" target="_blank" rel="noopener noreferrer">kovarik.xyz</a></p>
    </footer>

    <div class="ticker-bar" aria-live="polite" aria-label="Announcement">
        <div class="ticker-inner">
            <div class="ticker-motion">
                <div class="ticker-group">
                    <a class="ticker-link" href="https://open.spotify.com/album/0Z7BWVEHBT8qQdcuNCSW4S" target="_blank" rel="noopener noreferrer">
                        NEW ALBUM <span class="ticker-accent">SLUN</span> OUT NOW ON ALL STREAMING PLATFORMS
                    </a>
                    <a class="ticker-link" href="https://open.spotify.com/album/0Z7BWVEHBT8qQdcuNCSW4S" target="_blank" rel="noopener noreferrer">
                        NEW ALBUM <span class="ticker-accent">SLUN</span> OUT NOW ON ALL STREAMING PLATFORMS
                    </a>
                    <a class="ticker-link" href="https://open.spotify.com/album/0Z7BWVEHBT8qQdcuNCSW4S" target="_blank" rel="noopener noreferrer">
                        NEW ALBUM <span class="ticker-accent">SLUN</span> OUT NOW ON ALL STREAMING PLATFORMS
                    </a>
                </div>
                <div class="ticker-group" aria-hidden="true">
                    <a class="ticker-link" href="https://open.spotify.com/album/0Z7BWVEHBT8qQdcuNCSW4S" target="_blank" rel="noopener noreferrer">
                        NEW ALBUM <span class="ticker-accent">SLUN</span> OUT NOW ON ALL STREAMING PLATFORMS
                    </a>
                    <a class="ticker-link" href="https://open.spotify.com/album/0Z7BWVEHBT8qQdcuNCSW4S" target="_blank" rel="noopener noreferrer">
                        NEW ALBUM <span class="ticker-accent">SLUN</span> OUT NOW ON ALL STREAMING PLATFORMS
                    </a>
                    <a class="ticker-link" href="https://open.spotify.com/album/0Z7BWVEHBT8qQdcuNCSW4S" target="_blank" rel="noopener noreferrer">
                        NEW ALBUM <span class="ticker-accent">SLUN</span> OUT NOW ON ALL STREAMING PLATFORMS
                    </a>
                </div>
            </div>
        </div>
    </div>

    

    <script>
        // Enhanced Arrow Key Navigation
        document.addEventListener('DOMContentLoaded', function() {
            const scrollDistance = window.innerHeight * 0.6; // Scroll 60% of viewport height
            
            document.addEventListener('keydown', function(e) {
                // Only handle arrow keys when not in an input/textarea
                if (['input', 'textarea', 'select'].includes(e.target.tagName.toLowerCase())) {
                    return;
                }
                
                switch(e.key) {
                    case 'ArrowUp':
                        e.preventDefault();
                        window.scrollBy({
                            top: -scrollDistance,
                            behavior: 'smooth'
                        });
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        window.scrollBy({
                            top: scrollDistance,
                            behavior: 'smooth'
                        });
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        window.scrollBy({
                            left: -scrollDistance,
                            behavior: 'smooth'
                        });
                        break;
                    case 'ArrowRight':
                        e.preventDefault();
                        window.scrollBy({
                            left: scrollDistance,
                            behavior: 'smooth'
                        });
                        break;
                }
            });
        });

        // Open Graph Image Fetcher
        async function fetchOGImage(url, imgElement) {
            try {
                // Use a CORS proxy service to fetch OG data
                const proxyUrl = 'https://api.allorigins.win/get?url=';
                const response = await fetch(proxyUrl + encodeURIComponent(url));
                const data = await response.json();
                
                if (data.contents) {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(data.contents, 'text/html');
                    
                    // Look for Open Graph image
                    let ogImage = doc.querySelector('meta[property="og:image"]');
                    if (!ogImage) {
                        ogImage = doc.querySelector('meta[name="og:image"]');
                    }
                    
                    if (ogImage && ogImage.content) {
                        // Make sure the URL is absolute
                        let imageUrl = ogImage.content;
                        if (imageUrl.startsWith('//')) {
                            imageUrl = 'https:' + imageUrl;
                        } else if (imageUrl.startsWith('/')) {
                            const urlObj = new URL(url);
                            imageUrl = urlObj.origin + imageUrl;
                        }
                        
                        imgElement.src = imageUrl;
                        imgElement.onerror = function() {
                            // Fallback to mint.JPG if OG image fails to load
                            console.log('OG image failed to load for:', url, 'using mint.JPG fallback');
                            imgElement.src = 'images/mint.JPG';
                        };
                    }
                }
            } catch (error) {
                console.log('Error fetching OG image for:', url, error, 'using mint.JPG fallback');
                // Fallback to mint.JPG if fetch fails
                imgElement.src = 'images/mint.JPG';
            }
        }
        
        // YouTube thumbnail extractor
        function getYouTubeThumb(url) {
            const videoId = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/);
            if (videoId) {
                return `https://img.youtube.com/vi/${videoId[1]}/maxresdefault.jpg`;
            }
            return null;
        }
        

        
        // Initialize OG image fetching when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('[data-fetch-og="true"]');
            
            cards.forEach(card => {
                const link = card.href;
                const img = card.querySelector('.og-image');
                
                if (link && img && link !== window.location.href + '#') {
                    // Special handling for YouTube
                    if (link.includes('youtube.com') || link.includes('youtu.be')) {
                        const thumbUrl = getYouTubeThumb(link);
                        if (thumbUrl) {
                            img.src = thumbUrl;
                            return;
                        }
                    }
                    
                    // For all non-YouTube URLs, try to fetch OG image with mint.JPG fallback
                    fetchOGImage(link, img);
                }
            });
        });

        // Google Sheets loader for Upcoming shows
        function buildGvizUrl(sheetId, sheetName, sheetGid) {
            const gid = (sheetGid || '').trim();
            if (gid) {
                return `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?gid=${gid}`;
            }
            const encodedSheetName = encodeURIComponent(sheetName || 'Sheet1');
            return `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?sheet=${encodedSheetName}`;
        }

        function extractGvizJson(text) {
            // gviz returns JS like: google.visualization.Query.setResponse({...});
            const start = text.indexOf('{');
            const end = text.lastIndexOf('}');
            if (start === -1 || end === -1) return null;
            try {
                return JSON.parse(text.slice(start, end + 1));
            } catch (e) {
                return null;
            }
        }

        function formatCellValue(cell) {
            if (!cell) return '';
            if (typeof cell.f !== 'undefined' && cell.f !== null) return String(cell.f);
            if (typeof cell.v === 'object' && cell.v !== null) return String(cell.v);
            return typeof cell.v !== 'undefined' && cell.v !== null ? String(cell.v) : '';
        }

        function createTicketsCellContent(value) {
            const trimmed = value.trim();
            if (!trimmed) {
                return document.createTextNode('Tickets at the door');
            }
            const isUrl = /^https?:\/\//i.test(trimmed);
            if (!isUrl) return document.createTextNode(trimmed);
            const a = document.createElement('a');
            a.href = trimmed;
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            a.className = 'ticket-link';
            a.textContent = 'Tickets';
            return a;
        }

        function createEventCellContent(value) {
            const trimmed = value.trim();
            if (!trimmed) return document.createTextNode('');
            const isUrl = /^https?:\/\//i.test(trimmed);
            if (!isUrl) return document.createTextNode(trimmed);
            const a = document.createElement('a');
            a.href = trimmed;
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            a.className = 'ticket-link';
            a.textContent = 'Event';
            return a;
        }

        async function loadShowsFromGoogleSheet(sheetId, sheetName, sheetGid) {
            try {
                const url = buildGvizUrl(sheetId, sheetName, sheetGid);
                const res = await fetch(url);
                const text = await res.text();
                const json = extractGvizJson(text);
                if (!json || !json.table || !Array.isArray(json.table.rows)) return [];
                return json.table.rows
                    .map(r => (r && Array.isArray(r.c)) ? r.c : [])
                    .map(cols => ({
                        date: formatCellValue(cols[0]),
                        city: formatCellValue(cols[1]),
                        venue: formatCellValue(cols[2]),
                        tickets: formatCellValue(cols[3]),
                        event: formatCellValue(cols[4])
                    }))
                    .filter(row => row.date || row.city || row.venue || row.tickets || row.event);
            } catch (e) {
                return [];
            }
        }

        async function initShowsTables() {
            const containers = document.querySelectorAll('.shows-container');
            if (!containers.length) return;

            for (const container of containers) {
                const tbody = container.querySelector('tbody') || document.getElementById('shows-tbody');
                const wrapper = container.querySelector('.shows-table-wrapper');
                if (!tbody) continue;

                const sheetId = (container.getAttribute('data-sheet-id') || '').trim();
                const sheetName = (container.getAttribute('data-sheet-name') || 'Upcoming').trim();
                const sheetGid = (container.getAttribute('data-sheet-gid') || '').trim();

                // If no sheet configured yet, leave the placeholder row
                if (!sheetId) continue;

                const rows = await loadShowsFromGoogleSheet(sheetId, sheetName, sheetGid);
                // Clear existing tbody
                tbody.innerHTML = '';

                if (!rows.length) {
                    const tr = document.createElement('tr');
                    const td = document.createElement('td');
                    td.colSpan = 5;
                    td.className = 'shows-empty';
                    td.textContent = 'No upcoming shows yet';
                    tr.appendChild(td);
                    tbody.appendChild(tr);
                    continue;
                }

                rows.forEach(row => {
                    const tr = document.createElement('tr');
                    const dateTd = document.createElement('td');
                    dateTd.textContent = row.date;
                    const cityTd = document.createElement('td');
                    cityTd.textContent = row.city;
                    const venueTd = document.createElement('td');
                    venueTd.textContent = row.venue;
                    const ticketsTd = document.createElement('td');
                    ticketsTd.appendChild(createTicketsCellContent(row.tickets));
                    const eventTd = document.createElement('td');
                    eventTd.appendChild(createEventCellContent(row.event));

                    tr.appendChild(dateTd);
                    tr.appendChild(cityTd);
                    tr.appendChild(venueTd);
                    tr.appendChild(ticketsTd);
                    tr.appendChild(eventTd);
                    tbody.appendChild(tr);
                });

                // If more than 8 events, cap visible height and enable vertical scroll
                try {
                    const trEls = tbody.querySelectorAll('tr');
                    if (trEls.length > 8 && wrapper) {
                        let capHeight = 0;
                        for (let i = 0; i < 8; i++) {
                            capHeight += trEls[i].offsetHeight;
                        }
                        // Add 1px buffer for borders
                        wrapper.style.maxHeight = (capHeight + 1) + 'px';
                        wrapper.style.overflowY = 'auto';
                    }
                } catch (e) { /* no-op */ }
            }
        }

        document.addEventListener('DOMContentLoaded', initShowsTables);

        // Build JSON-LD from dynamic rows for SEO
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const container = document.querySelector('.shows-container');
                if (!container) return;
                const sheetId = (container.getAttribute('data-sheet-id') || '').trim();
                const sheetName = (container.getAttribute('data-sheet-name') || 'Upcoming').trim();
                const sheetGid = (container.getAttribute('data-sheet-gid') || '').trim();
                if (!sheetId) return;
                const rows = await loadShowsFromGoogleSheet(sheetId, sheetName, sheetGid);
                if (!rows.length) return;

                const events = rows.map(r => {
                    // Attempt to parse date into ISO (YYYY-MM-DD). If not parseable, skip startDate.
                    let isoDate = undefined;
                    const m = r.date && r.date.match(/(\d{1,2})\.(\d{1,2})\.(\d{4})?/);
                    if (m) {
                        const d = m[1].padStart(2, '0');
                        const mo = m[2].padStart(2, '0');
                        const y = m[3] || String(new Date().getFullYear());
                        isoDate = `${y}-${mo}-${d}`;
                    }
                    const locationName = r.venue || '';
                    const city = r.city || '';
                    const mapQuery = locationName && city ? `${locationName} ${city}` : (locationName || city);
                    const locationSameAs = mapQuery ? `https://maps.google.com/?q=${encodeURIComponent(mapQuery)}` : undefined;
                    const offersUrl = /^https?:\/\//i.test(r.tickets || '') ? r.tickets : undefined;
                    return {
                        '@type': 'Event',
                        name: city ? `Island Mint — ${city}` : 'Island Mint',
                        ...(isoDate ? { startDate: isoDate } : {}),
                        eventAttendanceMode: 'https://schema.org/OfflineEventAttendanceMode',
                        eventStatus: 'https://schema.org/EventScheduled',
                        location: {
                            '@type': 'Place',
                            name: locationName || 'Venue',
                            address: {
                                '@type': 'PostalAddress',
                                addressLocality: city || '',
                                addressCountry: ''
                            },
                            ...(locationSameAs ? { sameAs: locationSameAs } : {})
                        },
                        ...(offersUrl ? { offers: { '@type': 'Offer', url: offersUrl, availability: 'https://schema.org/InStock' } } : {}),
                        performer: { '@type': 'MusicGroup', name: 'Island Mint' }
                    };
                });

                const script = document.createElement('script');
                script.type = 'application/ld+json';
                script.textContent = JSON.stringify({ '@context': 'https://schema.org', '@graph': events });
                document.head.appendChild(script);
            } catch (e) {}
        });

        var
        COLS,
        ROWS,
        EMPTY = 0,
        SNAKE = 1,
        FRUIT = 2,
        LEFT  = 0,
        UP    = 1,
        RIGHT = 2,
        DOWN  = 3,
        KEY_LEFT  = 37,
        KEY_UP    = 38,
        KEY_RIGHT = 39,
        KEY_DOWN  = 40,
        canvas,	  
        ctx,	  
        keystate, 
        frames,   
        score,
        gameRunning = true;	  
         
        grid = {
         
            width: null,  
            height: null, 
            _grid: null,  
         
            init: function(d, c, r) {
                this.width = c;
                this.height = r;
         
                this._grid = [];
                for (var x=0; x < c; x++) {
                this._grid.push([]);
                for (var y=0; y < r; y++) {
                this._grid[x].push(d);
                }
                }
            },
         
            set: function(val, x, y) {
                this._grid[x][y] = val;
            },
         
            get: function(x, y) {
                return this._grid[x][y];
            }
        }
         
        snake = {
         
            direction: null, 
            last: null,	 
            _queue: null,	
         
            init: function(d, x, y) {
                this.direction = d;
         
                this._queue = [];
                this.insert(x, y);
            },
         
            insert: function(x, y) {
                this._queue.unshift({x:x, y:y});
                this.last = this._queue[0];
            },
         
            remove: function() {
                return this._queue.pop();
            }
        };
         
        function setFood() {
            var empty = [];
            
            for (var x=0; x < grid.width; x++) {
                for (var y=0; y < grid.height; y++) {
                if (grid.get(x, y) === EMPTY) {
                empty.push({x:x, y:y});
                }
                }
            }
            
            var randpos = empty[Math.round(Math.random()*(empty.length - 1))];
            grid.set(FRUIT, randpos.x, randpos.y);
        }

        function toggleGame() {
            gameRunning = !gameRunning;
        }
         
        function main() {
            // Calculate grid size based on screen size
            var cellSize = 25;
            COLS = Math.floor(window.innerWidth / cellSize);
            ROWS = Math.floor(window.innerHeight / cellSize);
            
            canvas = document.createElement("canvas");
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx = canvas.getContext("2d");
            
            document.getElementById('snake-game').appendChild(canvas);
         
            // Set font size to be consistent regardless of screen size
            ctx.font = "16px Nunito Sans, Helvetica, sans-serif";
         
            frames = 0;
            keystate = {};
            
            document.addEventListener("keydown", function(evt) {
                keystate[evt.keyCode] = true;
            });
            document.addEventListener("keyup", function(evt) {
                delete keystate[evt.keyCode];
            });

            // Add click handler to the separate controls div
            document.querySelector('.game-controls').addEventListener('click', function(evt) {
                toggleGame();
            });

            // Handle window resize
            window.addEventListener('resize', function() {
                COLS = Math.floor(window.innerWidth / cellSize);
                ROWS = Math.floor(window.innerHeight / cellSize);
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                // Reset font after canvas resize
                ctx.font = "16px Nunito Sans, Helvetica, sans-serif";
                init();
            });
         
            init();
            loop();
        }
         
        function init() {
            score = 0;
         
            grid.init(EMPTY, COLS, ROWS);
         
            var sp = {x:Math.floor(COLS/2), y:ROWS-1};
            snake.init(UP, sp.x, sp.y);
            grid.set(SNAKE, sp.x, sp.y);
         
            setFood();
        }
         
        function loop() {
            update();
            draw();
            
            window.requestAnimationFrame(loop, canvas);
        }
         
        function update() {
            if (!gameRunning) return;
            
            frames++;
         
            if (keystate[KEY_LEFT] && snake.direction !== RIGHT) {
            snake.direction = LEFT;
            }
            if (keystate[KEY_UP] && snake.direction !== DOWN) {
            snake.direction = UP;
            }
            if (keystate[KEY_RIGHT] && snake.direction !== LEFT) {
            snake.direction = RIGHT;
            }
            if (keystate[KEY_DOWN] && snake.direction !== UP) {
            snake.direction = DOWN;
            }

            // Calculate speed based on score - starts at 8, gets faster as score increases
            // Minimum speed of 3 frames to keep it playable
            var gameSpeed = Math.max(3, 8 - Math.floor(score / 3));
         
            if (frames%gameSpeed === 0) {
            var nx = snake.last.x;
            var ny = snake.last.y;
         
            switch (snake.direction) {
            case LEFT:
            nx--;
            break;
            case UP:
            ny--;
            break;
            case RIGHT:
            nx++;
            break;
            case DOWN:
            ny++;
            break;
            }
         
            if (0 > nx || nx > grid.width-1  ||
            0 > ny || ny > grid.height-1 ||
            grid.get(nx, ny) === SNAKE
            ) {
            return init();
            }
         
            if (grid.get(nx, ny) === FRUIT) {
            score++;
            setFood();
            } else {
            var tail = snake.remove();
            grid.set(EMPTY, tail.x, tail.y);
            }
         
            grid.set(SNAKE, nx, ny);
            snake.insert(nx, ny);
            }
        }
         
        function draw() {
            // Clear canvas with transparent background
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            var tw = canvas.width/grid.width;
            var th = canvas.height/grid.height;
            
            // Only draw game elements if running
            if (gameRunning) {
                for (var x=0; x < grid.width; x++) {
                for (var y=0; y < grid.height; y++) {
                switch (grid.get(x, y)) {
                case EMPTY:
                // Don't draw anything for empty spaces (transparent)
                break;
                case SNAKE:
                ctx.fillStyle = "rgba(255,255,255,0.9)";
                ctx.fillRect(x*tw, y*th, tw-1, th-1);
                break;
                case FRUIT:
                ctx.fillStyle = "rgba(255,0,255,0.9)";
                ctx.fillRect(x*tw, y*th, tw-1, th-1);
                break;
                }
                }
                }
            }
            
            // Create the full display text with ASCII symbols
            var displayText = "SCORE: " + score + " | " + (gameRunning ? "⏸" : "▶");
            var textWidth = ctx.measureText(displayText).width;
            
            // Draw the complete text (no background)
            ctx.fillStyle = "rgba(255,255,255,0.9)";
            ctx.fillText(displayText, 20, 32);
        }
         
        // Start the game when page loads
        window.addEventListener('load', main);

        // Slun modal logic: show once per session
        document.addEventListener('DOMContentLoaded', function() {
            try {
                var modal = document.getElementById('slun-modal');
                if (!modal) return;

                var hasSeen = sessionStorage.getItem('slunModalSeen') === 'true';
                if (!hasSeen) {
                    modal.classList.add('is-visible');
                    modal.setAttribute('aria-hidden', 'false');
                    sessionStorage.setItem('slunModalSeen', 'true');
                }

                // Close handlers
                var closeBtn = modal.querySelector('.slun-modal-close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        modal.classList.remove('is-visible');
                        modal.setAttribute('aria-hidden', 'true');
                    });
                }

                // Click outside to close
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.remove('is-visible');
                        modal.setAttribute('aria-hidden', 'true');
                    }
                });

                // Escape key to close
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && modal.classList.contains('is-visible')) {
                        modal.classList.remove('is-visible');
                        modal.setAttribute('aria-hidden', 'true');
                    }
                });
            } catch (err) {
                // No-op if storage blocked
            }
        });
    </script>
</body>
</html> 
